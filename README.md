# ТЕСТОВОЕ ЗАДАНИЕ

Реализовать асинхронное API с функционалом:

## Задача
1. POST запрос - отправка файла-изображения графического формата
   (jpeg, png и пр.);
2. Конвертирование полученного файла-изображения, отличного от формата
   jpeg в jpeg-формат, и сохранение результата в базу данных;
3. Модернизация POST запроса (см. п. 1) - отправка файла-изображения
   графического формата (jpeg, png и пр) с передачей необязательных
   параметров компрессии:
   - quality = качество (в %),
   - x = ширина изображения,
   - y = высота изображения.
4. При заданных параметрах (см. п. 3), реализовать компрессию
   jpeg-изображения (в том числе, полученного после
   конвертирования, см. п. 2) с последующим сохранением 
   результата в базе данных;
5. GET запрос – получение сохраненного изображения из базы данных
   по идентификатору;

| Задача | Приоритет выполнения |
|--------|----------------------|
| 1      | 1                    |
| 2      | 1                    |
| 3      | 2                    |
| 4      | 2                    |
| 5      | 1                    |

## Дополнительные требования
1. Покрыть реализацию логированием;
2. Реализовать метод АПИ, обеспечивающий чтение логов;
3. Реализовать token-based авторизацию - ограничить доступ функционала АПИ с помощью авторизации по bearer-токену.

## Требования к окружению
1. Python 3.7+, приоритетная версия 3.9
2. PostgreSQL 14.1+
3. Асинхронное АПИ – использовать фреймворк aiohttp
4. Взаимодействие с базой данных – использовать пакет asyncpg
5. Конвертирование и компрессия изображения – использовать пакет pillow
6. Логирование - использовать пакет logging

## Формат логов:

    %(asctime)s,%(msecs)d: %(route)s: %(functionName)s: %(levelname)s: %(message)s

---
## Описание структуры проекта:

- config - Конфигурационные файлы проекта
  - logging.yaml - Конфигурационный файл логирования
  - settings.yaml - Конфигурационный файл проекта
- data
  - image - Путь к сохраняемым изображениям
- dev - Инструменты для дебага
  - scripts
    - db - Скрипты взаимодействия с базой данных
      - fill_db.py - Скрипт исполняющий создание записей в таблице images базы данных
    - requests - Скрипты исполняющие запросы к серверу
      - bad_token - Неверный токен для проверки аутентификации
      - get_request_image.ps1 - Скрипт исполняющий get запрос к корневому адресу сервера
      - post_request_image.ps1 - Скрипт исполняющий post запрос к корневому адресу сервера
      - get_request_log.ps1 - Скрипт исполняющий get запрос к /log/ сервера
    - utils - Утилиты
      - generate_big_file.ps1 - Генерация массивного файла
- image_converter - Модуль с выполненным заданием
  - backend - Модуль содержащий код серверной части
    - db - Модуль содержащий описание базы данных
      - context.py - Контекстный менеджер для aiohttp
      - settings.py - Настройки базы данных
    - views - Модуль содержащий код обработки запросов
      - images - Модуль содержащий handler запросов изображений и логику 
        - get - Логика обработки get запросов
          - get.py - Логика обработки get запросов
          - helpers.py - Дополнительные функции модуля get
        - post - Логика обработки post запросов
          - helpers.py - Дополнительные функции модуля get
          - post.py - Логика обработки post запросов
        - view.py - Handler для запросов изображений
      - log - Модуль содержащий handler запросов лога и логику
        - logic - Логика обработки запросов
          - get - Логика обработки get запросов
            - get.py - Логика обработки get запросов
        - view.py - Handler для запросов лога
      - decorators.py - Декораторы для handler-ов
      - helpers.py - Дополнительные функции модуля views
    - models.py - Инициализатор моделей базы данных
    - routes.py - Инициализатор путей запросов
  - images - Модуль содержащий код конвертора изображений
    - converter.py - Конвертер изображения
  - logger.py - Инициализатор логирования
  - main.py - Entrypoint
  - policy.py - Настройка политик исполнения для Windows
  - settings.py - Инициализатор настроек
- logs - Логи
- scripts - Скрипты для инициализации базы данных

## Запуск

1. Установить менеджер зависимостей https://python-poetry.org/
2. Запустить терминал из корня проекта
3. Запустить

       poetry install

4. Необходимо произвести настройку конфигурации проекта,
   базы данных
5. Запустить скрипты инициализации базы данных
   
       python ./scripts/init_db.py
       python ./scripts/create_user.py

6. Запустить приложение

       python ./image_converter/main.py

*Примечание: Заголовки запросов к приложению содержатся в /dev/scripts/requests* 

## Описание реализации

Завершеннось: Основные и дополнительные требования соблюдены

Документирование: Все классы, методы, константы и функции документированы

Дополнительно: При дополнительной доработке приложения
предполагается:
1. Настроить docker окружение
2. Настроить окружение tox
3. Написать юнит тесты
4. Добавить абстрактные классы в реализацию view
5. Добавить абстрактные классы в реализацию view logic

## Срок исполнения

Задача была поставлена 06.06.2022. При этом срок исполнения
указывался 3-4 вечера. Задача исполнена 09.06.2022. Т.е., в пределах срока.